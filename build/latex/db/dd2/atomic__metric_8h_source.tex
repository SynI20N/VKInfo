\hypertarget{atomic__metric_8h_source}{}\doxysection{atomic\+\_\+metric.\+h}
\label{atomic__metric_8h_source}\index{/home/leonid/Projects/VKInfo/VKInfoLib/include/atomic\_metric.h@{/home/leonid/Projects/VKInfo/VKInfoLib/include/atomic\_metric.h}}

\begin{DoxyCode}{0}
\DoxyCodeLine{1 \textcolor{preprocessor}{\#ifndef ATOMIC\_METRIC\_H\_}}
\DoxyCodeLine{2 \textcolor{preprocessor}{\#define ATOMIC\_METRIC\_H\_}}
\DoxyCodeLine{3 }
\DoxyCodeLine{4 \textcolor{preprocessor}{\#include <string>}}
\DoxyCodeLine{5 \textcolor{preprocessor}{\#include <atomic>}}
\DoxyCodeLine{6 \textcolor{preprocessor}{\#include <stdexcept>}}
\DoxyCodeLine{7 \textcolor{preprocessor}{\#include <random>}}
\DoxyCodeLine{8 }
\DoxyCodeLine{9 \textcolor{preprocessor}{\#include "{}metric.h"{}}}
\DoxyCodeLine{10 }
\DoxyCodeLine{11 \textcolor{keyword}{namespace }VkInfo \{}
\DoxyCodeLine{12 }
\DoxyCodeLine{22 \textcolor{keyword}{template}<\textcolor{keyword}{typename} T>}
\DoxyCodeLine{23 \textcolor{keyword}{class }VKINFO\_API \mbox{\hyperlink{classVkInfo_1_1AtomicMetric}{AtomicMetric}} : \textcolor{keyword}{public} \mbox{\hyperlink{classVkInfo_1_1IMetric}{IMetric}} \{}
\DoxyCodeLine{24 \textcolor{keyword}{public}:}
\DoxyCodeLine{32     \mbox{\hyperlink{classVkInfo_1_1AtomicMetric_a843321c95153d0506e7ce47600a9959f}{AtomicMetric}}(\textcolor{keyword}{const} std::string\& name, T max, T min) }
\DoxyCodeLine{33         : name\_(name), value\_(0), max\_(max), min\_(min) \{\}}
\DoxyCodeLine{34 }
\DoxyCodeLine{41     \textcolor{keywordtype}{void} \mbox{\hyperlink{classVkInfo_1_1AtomicMetric_abad98195d5732557f8120035519e19b7}{set}}(T value) \{}
\DoxyCodeLine{42         validate(value);}
\DoxyCodeLine{43         value\_ = value;}
\DoxyCodeLine{44     \}}
\DoxyCodeLine{45 }
\DoxyCodeLine{51     \textcolor{keywordtype}{void} \mbox{\hyperlink{classVkInfo_1_1AtomicMetric_a61b2df3c0774404fb9354887e37584ad}{set\_random\_value}}()\textcolor{keyword}{ override }\{}
\DoxyCodeLine{52         \textcolor{keyword}{using }dist = std::uniform\_real\_distribution<double>;}
\DoxyCodeLine{53         \textcolor{keyword}{static} \textcolor{keyword}{thread\_local} std::mt19937 gen(std::random\_device\{\}());}
\DoxyCodeLine{54         dist real\_dist(\textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{double}\textcolor{keyword}{>}(min\_), \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{double}\textcolor{keyword}{>}(max\_));}
\DoxyCodeLine{55         value\_ = \textcolor{keyword}{static\_cast<}T\textcolor{keyword}{>}(real\_dist(gen));}
\DoxyCodeLine{56     \}}
\DoxyCodeLine{57 }
\DoxyCodeLine{63     std::string \mbox{\hyperlink{classVkInfo_1_1AtomicMetric_acacb7ad7f17f3b0d855a9f31a6d517f1}{get\_name}}()\textcolor{keyword}{ const override }\{}
\DoxyCodeLine{64         \textcolor{keywordflow}{return} name\_;}
\DoxyCodeLine{65     \}}
\DoxyCodeLine{66 }
\DoxyCodeLine{72     T \mbox{\hyperlink{classVkInfo_1_1AtomicMetric_ab728696a3775772c1696381a7acaa23a}{get\_value}}()\textcolor{keyword}{ const }\{}
\DoxyCodeLine{73         \textcolor{keywordflow}{return} value\_;}
\DoxyCodeLine{74     \}}
\DoxyCodeLine{75 }
\DoxyCodeLine{81     std::string \mbox{\hyperlink{classVkInfo_1_1AtomicMetric_a6ea8de63ea21c4d6a8e3c30838e381db}{get\_value\_and\_reset}}()\textcolor{keyword}{ override }\{}
\DoxyCodeLine{82         T val = value\_.exchange(0);}
\DoxyCodeLine{83         \textcolor{keywordflow}{return} std::to\_string(val);}
\DoxyCodeLine{84     \}}
\DoxyCodeLine{85 }
\DoxyCodeLine{86 \textcolor{keyword}{private}:}
\DoxyCodeLine{87     std::string name\_;         }
\DoxyCodeLine{88     std::atomic<T> value\_;     }
\DoxyCodeLine{89     T max\_;                    }
\DoxyCodeLine{90     T min\_;                    }
\DoxyCodeLine{91 }
\DoxyCodeLine{98     \textcolor{keywordtype}{void} validate(T\& value) \{}
\DoxyCodeLine{99         \textcolor{keywordflow}{if} (value > max\_) \{}
\DoxyCodeLine{100             \textcolor{keywordflow}{throw} std::domain\_error(\textcolor{stringliteral}{"{}metric value exceeds max value"{}});}
\DoxyCodeLine{101         \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (value < min\_) \{}
\DoxyCodeLine{102             \textcolor{keywordflow}{throw} std::domain\_error(\textcolor{stringliteral}{"{}metric value underflows"{}});}
\DoxyCodeLine{103         \}}
\DoxyCodeLine{104     \}}
\DoxyCodeLine{105 \};}
\DoxyCodeLine{106 }
\DoxyCodeLine{107 \} \textcolor{comment}{// namespace VkInfo}}
\DoxyCodeLine{108 }
\DoxyCodeLine{109 \textcolor{preprocessor}{\#endif }\textcolor{comment}{// ATOMIC\_METRIC\_H\_}}

\end{DoxyCode}
